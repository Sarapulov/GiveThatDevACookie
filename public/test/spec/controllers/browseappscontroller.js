
describe('Controller: BrowseAppsController', function () {

  // load the controller's module
  beforeEach(module('GiveThatDevACookieApp'));

  var BrowseAppsController, scope, $httpBackend, ngDialog;

  // Initialize the controller and a mock scope
  beforeEach(inject(function ($controller, _$httpBackend_,  $rootScope, browseAppsFactory, ngDialog) {

      $httpBackend = _$httpBackend_;
      $httpBackend.expectGET("https://localhost:3443/apps").respond([{"_id":"590a216158174223e5e419b0","updatedAt":"2017-05-03T18:44:51.465Z","createdAt":"2017-05-03T18:28:49.119Z","title":"Bulk ticket delete app","description":"A full-page Zendesk nav bar app enables you to run search queries to fetch required data and remove it in few clicks.","download_url":"https://github.com/Sarapulov/bulk-delete-app","category":"app","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"__v":3,"tags":"zendesk delete ticket js","comments":[{"updatedAt":"2017-05-03T18:30:42.078Z","createdAt":"2017-05-03T18:30:42.078Z","rating":5,"comment":"Great app, adds value!","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a21d258174223e5e419b1"},{"updatedAt":"2017-05-03T18:40:20.232Z","createdAt":"2017-05-03T18:40:20.232Z","rating":3,"comment":"Failed many times. Request to improve!","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a241498b6a623edf4e2cf"},{"updatedAt":"2017-05-03T18:44:51.465Z","createdAt":"2017-05-03T18:44:51.465Z","rating":4,"comment":"This is great solution, but had to fix few bugs before using it","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a252398b6a623edf4e2d5"}],"featured":true,"image_url":"https://github.com/Sarapulov/bulk-delete-app/blob/master/assets/logo.png?raw=true"},{"_id":"590a22a898b6a623edf4e2c9","updatedAt":"2017-05-03T18:45:27.217Z","createdAt":"2017-05-03T18:34:16.370Z","title":"Parse and Set app","description":"Hidden Zendesk application which allows parsing predefined ticket fields and set other fields","download_url":"https://github.com/Sarapulov/parse_and_set_app","category":"app","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"__v":3,"tags":"zendesk parse set js","comments":[{"updatedAt":"2017-05-03T18:35:06.423Z","createdAt":"2017-05-03T18:35:06.423Z","rating":4,"comment":"Used many times. However, been unstable on IE browser.","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a22da98b6a623edf4e2ca"},{"updatedAt":"2017-05-03T18:39:38.974Z","createdAt":"2017-05-03T18:39:38.974Z","rating":5,"comment":"Super happy with this one!","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a23ea98b6a623edf4e2ce"},{"updatedAt":"2017-05-03T18:45:27.217Z","createdAt":"2017-05-03T18:45:27.217Z","rating":5,"comment":"Best! Plug and play exprience.","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a254798b6a623edf4e2d6"}],"featured":false,"image_url":"http://aprenda.vidageek.net/static/regex/logo.png"},{"_id":"590a238298b6a623edf4e2cc","updatedAt":"2017-05-03T18:45:54.643Z","createdAt":"2017-05-03T18:37:54.763Z","title":"Attachment reminder app","description":"Attachment Reminder App will disable the submit button on Zendesk ticket and warn you when given terms/keywords are present in the comment","download_url":"https://github.com/Sarapulov/attachment_reminder_app","category":"app","postedBy":{"_id":"590a235398b6a623edf4e2cb","username":"app_user","__v":0,"admin":false,"lastname":"Bond","firstname":"James"},"__v":1,"tags":"attachment reminder js","comments":[{"updatedAt":"2017-05-03T18:45:54.643Z","createdAt":"2017-05-03T18:45:54.643Z","rating":2,"comment":"App is outdated. Please upgrade it to ZAFv2","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a256298b6a623edf4e2d7"}],"featured":false,"image_url":"https://d1eipm3vz40hy0.cloudfront.net/images/p-apps-marketplace/apps/84814/logo.png"},{"_id":"590a23a398b6a623edf4e2cd","updatedAt":"2017-05-03T18:38:27.078Z","createdAt":"2017-05-03T18:38:27.078Z","title":"Delete organization with tag","description":"Ruby script which allows deleting specific Zendesk organization which contains a tag","download_url":"https://github.com/Sarapulov/delete-org-with-tag","category":"script","postedBy":{"_id":"590a235398b6a623edf4e2cb","username":"app_user","__v":0,"admin":false,"lastname":"Bond","firstname":"James"},"__v":0,"tags":"zendesk delete organizaton tag ruby","comments":[],"featured":true,"image_url":"https://bgasparotto.com/wp-content/uploads/2016/03/ruby-logo.png"},{"_id":"590a244b98b6a623edf4e2d0","updatedAt":"2017-05-03T18:46:50.356Z","createdAt":"2017-05-03T18:41:15.266Z","title":"CSV export command line","description":"Command line tool to export tickets","download_url":"https://github.com/zendesklabs/csv_export_command_line","category":"script","postedBy":{"_id":"590a235398b6a623edf4e2cb","username":"app_user","__v":0,"admin":false,"lastname":"Bond","firstname":"James"},"__v":2,"tags":"zendesk csv export ruby","comments":[{"updatedAt":"2017-05-03T18:41:47.221Z","createdAt":"2017-05-03T18:41:47.221Z","rating":5,"comment":"Love it!","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a246b98b6a623edf4e2d1"},{"updatedAt":"2017-05-03T18:46:50.355Z","createdAt":"2017-05-03T18:46:50.355Z","rating":5,"comment":"I gave highest score. Although, the solution is a bit complex for ordinary user.","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a259a98b6a623edf4e2d8"}],"featured":false,"image_url":"http://novasoloinventory.com/img/excel_logo.png"},{"_id":"590a24b998b6a623edf4e2d3","updatedAt":"2017-05-03T18:49:29.697Z","createdAt":"2017-05-03T18:43:05.792Z","title":"Systems integrator Zapier","description":"Easy automation for busy people. Zapier moves info between your web apps automatically, so you can focus on your most important work.","download_url":"https://zapier.com/zapbook/zendesk/","category":"web_service","postedBy":{"_id":"590a249298b6a623edf4e2d2","username":"app_user2","__v":0,"admin":false,"lastname":"Lee","firstname":"Bruce"},"__v":1,"tags":"zapier zendesk","comments":[{"updatedAt":"2017-05-03T18:49:29.697Z","createdAt":"2017-05-03T18:49:29.697Z","rating":5,"comment":"One of the best integrators I ever used, Recommended","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a263998b6a623edf4e2da"}],"featured":true,"image_url":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Zapier_logo.png/320px-Zapier_logo.png"},{"_id":"590a24c898b6a623edf4e2d4","updatedAt":"2017-05-05T19:23:48.249Z","createdAt":"2017-05-03T18:43:20.696Z","title":"Systems integrator tray.io","description":"Increase your productivity by integrating the services you use everyday","download_url":"https://tray.io/","category":"web_service","postedBy":{"_id":"590a249298b6a623edf4e2d2","username":"app_user2","__v":0,"admin":false,"lastname":"Lee","firstname":"Bruce"},"__v":2,"tags":"tray zendesk","comments":[{"updatedAt":"2017-05-03T18:48:50.700Z","createdAt":"2017-05-03T18:48:50.700Z","rating":5,"comment":"Used it many times. Life saver.","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590a261298b6a623edf4e2d9"},{"updatedAt":"2017-05-05T19:23:48.249Z","createdAt":"2017-05-05T19:23:48.249Z","rating":5,"comment":"Want to say it again: great app!","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590cd144b212492d5b659575"}],"featured":false,"image_url":"https://d1qb2nb5cznatu.cloudfront.net/startups/i/83404-b8ae2298a1a9f9fd7b0ab8d62e7a0e57-medium_jpg.jpg"},{"_id":"590cdc6eb212492d5b659576","updatedAt":"2017-05-05T20:11:46.851Z","createdAt":"2017-05-05T20:11:26.651Z","title":"Requester TimeZone","description":"Shows the Timezone and current local time of the requester (based upon their user profile)","download_url":"https://github.com/zendesklabs/requester_timezone_app","category":"app","tags":"zendesk labs timezone","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"__v":1,"comments":[{"updatedAt":"2017-05-05T20:11:46.851Z","createdAt":"2017-05-05T20:11:46.851Z","rating":5,"comment":"it works!","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"_id":"590cdc82b212492d5b659577"}],"featured":false,"image_url":"http://img.ithome.com/newsuploadfiles/2012/11/20121127_141817_544.jpg"},{"_id":"590cdeb5b212492d5b659578","updatedAt":"2017-05-05T20:21:09.871Z","createdAt":"2017-05-05T20:21:09.871Z","title":"Download Recordings v1.02","description":"Introducing Download Recordings! A simple Zendesk app that allows you to download Zendesk Voice recordings to your local computer.","download_url":"https://github.com/zendesklabs/download_recordings_app","category":"app","tags":"zendesk labs","postedBy":{"_id":"590a0a5c357da8236e0a9fb5","username":"app_admin","__v":0,"admin":true,"lastname":"Sarapulov","firstname":"Andrey"},"__v":0,"comments":[],"featured":false,"image_url":"https://github.com/zendesklabs/download_recordings_app/blob/master/assets/logo.png?raw=true"}]);

    scope = $rootScope.$new();
    BrowseAppsController = $controller('BrowseAppsController', {
      $scope: scope,
      browseAppsFactory: browseAppsFactory,
      ngDialog: ngDialog
    });


  }));

  it('should have showApps as false', function () {
    expect(scope.showApps).toBe(false);
  });

  it('should create "apps" with 2 apps fetched from API request', function() {
      // expect(scope.dishes.length).toBe(0);
      $httpBackend.flush();
      // expect(scope.dishes.length).toBe(2);
      expect(scope.apps[0].title).toBe("Bulk ticket delete app");
      expect(scope.apps[1].title).toBe("Parse and Set app");

  });

});
